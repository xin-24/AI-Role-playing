# 角色音色匹配方案

## 概述
本方案旨在根据AI角色的性格特征、背景故事等信息，为每个角色自动匹配最合适的七牛云TTS音色，以提升角色扮演的真实感和沉浸感。

## 音色分类与角色匹配规则

### 1. 传统音色分类

#### 女性音色
| 音色名称 | 音色标识 | 适用角色特征 |
|---------|---------|-------------|
| 温婉学科讲师 | qiniu_zh_female_wwxkjx | 知性、温和、有学识的女性角色 |
| 甜美教学小源 | qiniu_zh_female_tmjxxy | 年轻、甜美、有教学背景的角色 |
| 校园清新学姐 | qiniu_zh_female_xyqxxj | 年轻、清新、校园背景的女性角色 |
| 邻家辅导学姐 | qiniu_zh_female_ljfdxx | 亲切、友善、有辅导经验的女性角色 |
| 干练课堂思思 | qiniu_zh_female_glktss | 干练、专业、有课堂经验的女性角色 |
| 开朗教学督导 | qiniu_zh_female_kljxdd | 开朗、有管理经验、教学督导角色 |
| 知性教学女教师 | qiniu_zh_female_zxjxnjs | 成熟、知性、有教学经验的女性角色 |
| 慈祥教学顾问 | qiniu_zh_female_cxjxgw | 年长、慈祥、有丰富教学经验的角色 |

#### 男性音色
| 音色名称 | 音色标识 | 适用角色特征 |
|---------|---------|-------------|
| 邻家辅导学长 | qiniu_zh_male_ljfdxz | 年轻、亲切、有辅导经验的男性角色 |
| 温和学科小哥 | qiniu_zh_male_whxkxg | 温和、有学识、年轻的男性角色 |
| 温暖沉稳学长 | qiniu_zh_male_wncwxz | 成熟、温暖、有学长风范的男性角色 |
| 渊博学科男教师 | qiniu_zh_male_ybxknjs | 博学、成熟、有教学经验的男性角色 |
| 通用阳光讲师 | qiniu_zh_male_tyygjs | 阳光、通用型、讲师角色 |
| 率真校园向导 | qiniu_zh_male_szxyxd | 年轻、率真、有向导经验的男性角色 |
| 火力少年凯凯 | qiniu_zh_male_hlsnkk | 年轻、活力、少年角色 |

### 2. 双语音色分类

#### 英语音色
| 音色名称 | 音色标识 | 适用角色特征 |
|---------|---------|-------------|
| 美式英语女 | qiniu_en_female_msyyn | 说英语的女性角色 |
| 美式英语男 | qiniu_en_male_msyyn | 说英语的男性角色 |
| 英式英语女 | qiniu_en_female_ysyyn | 说英式英语的女性角色 |
| 英式英语男 | qiniu_en_male_ysyyn | 说英式英语的男性角色 |
| 澳洲英语女 | qiniu_en_female_azyy | 说澳洲英语的女性角色 |
| 澳洲英语男 | qiniu_en_male_azyyn | 说澳洲英语的男性角色 |

#### 多语言音色
| 音色名称 | 音色标识 | 适用角色特征 |
|---------|---------|-------------|
| 日西双语女1 | qiniu_multi_female_rxsyn1 | 会日语和西班牙语的女性角色 |
| 日西双语女2 | qiniu_multi_female_rxsyn2 | 会日语和西班牙语的女性角色 |
| 日西双语男1 | qiniu_multi_male_rxsyn1 | 会日语和西班牙语的男性角色 |
| 日西双语男2 | qiniu_multi_male_rxsyn2 | 会日语和西班牙语的男性角色 |

### 3. 特殊音色分类

| 音色名称 | 音色标识 | 适用角色特征 |
|---------|---------|-------------|
| 动漫樱桃丸子 | qiniu_zh_female_dmytwz | 动漫角色、儿童角色 |
| 英语启蒙佩奇 | qiniu_zh_female_yyqmpq | 儿童教育角色 |
| 儿童故事熊二 | qiniu_zh_male_etgsxe | 儿童角色、动画角色 |
| 少儿故事配音 | qiniu_zh_female_segsby | 儿童故事讲述者 |
| 社区教育阿姨 | qiniu_zh_female_sqjyay | 年长女性、社区工作者 |
| 名著角色猴哥 | qiniu_zh_male_mzjsxg | 特定名著角色 |
| 古装剧教学版 | qiniu_zh_male_gzjjxb | 古装角色、历史人物 |
| 趣味知识传播 | qiniu_zh_female_qwzscb | 知识分享者、趣味内容 |
| 磁性课件男声 | qiniu_zh_male_cxkjns | 磁性声音、课件讲解 |
| 温婉课件配音 | qiniu_zh_female_wwkjby | 温和声音、课件讲解 |
| 天才少年示范 | qiniu_zh_male_tcsnsf | 天才少年角色 |
| 活力率真萌仔 | qiniu_zh_male_hllzmz | 年轻、活力、率真角色 |
| 轻松懒音绵宝 | qiniu_zh_male_qslymb | 轻松、慵懒角色 |

## 匹配算法实现建议

### 1. 关键词匹配
通过分析角色的描述信息，提取关键词进行音色匹配：

```java
// 示例匹配逻辑
public class VoiceSelectionService {
    
    public String selectVoiceForCharacter(Character character) {
        String description = character.getDescription().toLowerCase();
        String personality = character.getPersonalityTraits().toLowerCase();
        String background = character.getBackgroundStory().toLowerCase();
        
        // 教师/讲师相关
        if (description.contains("教师") || description.contains("讲师") || 
            description.contains("老师") || description.contains("教授")) {
            if (character.getGender() == Gender.FEMALE) {
                return "qiniu_zh_female_wwxkjx"; // 温婉学科讲师
            } else {
                return "qiniu_zh_male_ybxknjs"; // 渊博学科男教师
            }
        }
        
        // 学生/学长/学姐相关
        if (description.contains("学生") || description.contains("学长") || 
            description.contains("学姐") || background.contains("校园")) {
            if (character.getGender() == Gender.FEMALE) {
                if (personality.contains("甜美") || personality.contains("活泼")) {
                    return "qiniu_zh_female_xyqxxj"; // 校园清新学姐
                } else {
                    return "qiniu_zh_female_ljfdxx"; // 邻家辅导学姐
                }
            } else {
                if (personality.contains("温暖") || personality.contains("沉稳")) {
                    return "qiniu_zh_male_wncwxz"; // 温暖沉稳学长
                } else {
                    return "qiniu_zh_male_ljfdxz"; // 邻家辅导学长
                }
            }
        }
        
        // 默认音色
        return "qiniu_zh_female_wwxkjx";
    }
}
```

### 2. 相似度匹配
使用文本相似度算法计算角色描述与音色特征的匹配度：

```javascript
// 前端实现示例
function matchVoiceToCharacter(character) {
    const { description, personalityTraits, backgroundStory } = character;
    const characterText = `${description} ${personalityTraits} ${backgroundStory}`.toLowerCase();
    
    // 音色特征关键词映射
    const voiceCharacteristics = {
        "qiniu_zh_female_wwxkjx": ["知性", "温和", "讲师", "教师", "学识", "成熟"],
        "qiniu_zh_male_ybxknjs": ["博学", "成熟", "教师", "教授", "渊博"],
        "qiniu_zh_female_xyqxxj": ["年轻", "清新", "校园", "活泼", "甜美"],
        "qiniu_zh_male_ljfdxz": ["年轻", "亲切", "学长", "友好", "辅导"],
        // ... 其他音色特征映射
    };
    
    let bestMatch = "qiniu_zh_female_wwxkjx"; // 默认音色
    let highestScore = 0;
    
    for (const [voiceType, keywords] of Object.entries(voiceCharacteristics)) {
        let score = 0;
        for (const keyword of keywords) {
            if (characterText.includes(keyword)) {
                score++;
            }
        }
        
        if (score > highestScore) {
            highestScore = score;
            bestMatch = voiceType;
        }
    }
    
    return bestMatch;
}
```

## 实施建议

### 1. 数据库扩展
在角色表中添加音色设置字段：

```sql
ALTER TABLE characters ADD COLUMN voice_type VARCHAR(100) DEFAULT 'qiniu_zh_female_wwxkjx';
```

### 2. 后端服务更新
在Character实体类中添加voiceType字段：

```java
@Entity
@Table(name = "characters")
public class Character {
    // ... existing fields ...
    
    @Column(name = "voice_type")
    private String voiceType;
    
    // ... getters and setters ...
}
```

### 3. 自动匹配功能
在创建角色时自动匹配音色：

```java
@PostMapping
public Character createCharacter(@RequestBody Character character) {
    // 如果没有指定音色，则根据角色信息自动匹配
    if (character.getVoiceType() == null || character.getVoiceType().isEmpty()) {
        character.setVoiceType(voiceSelectionService.selectVoiceForCharacter(character));
    }
    
    // 设置创建时间
    character.setCreatedAt(LocalDateTime.now());
    character.setUpdatedAt(LocalDateTime.now());
    
    return characterRepository.save(character);
}
```

### 4. 前端集成
在角色创建表单中添加音色预览功能：

```jsx
// 在角色创建表单中添加音色选择和预览
<div>
    <label>角色音色:</label>
    <select 
        name="voiceType" 
        value={newCharacter.voiceType || recommendedVoice}
        onChange={handleInputChange}
    >
        {availableVoices.map(voice => (
            <option key={voice.voice_type} value={voice.voice_type}>
                {voice.voice_name}
            </option>
        ))}
    </select>
    <button type="button" onClick={() => previewVoice(recommendedVoice)}>
        试听推荐音色
    </button>
</div>
```

## 总结
通过以上方案，我们可以根据角色的性格特征、背景故事等信息自动匹配最合适的音色，提升AI角色扮演的沉浸感和真实感。系统既支持自动匹配，也允许用户手动选择，提供了良好的用户体验。